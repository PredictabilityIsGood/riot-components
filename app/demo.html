<demo>
    <div class="jumbotron jumbotron-fluid m-4">
        <div class="container">
            <h1 class="display-4 text-center text-muted">
                < widget-grid >
            </h1>
            <hr class="my-4">
            <div class="card w-100">
                <div class="card-header d-none">
                    Incidents
                </div>
                <widget-grid 
                    data="{state.sampleTableData.data}"
                    options="{state.sampleTableData.options}"
                    tableOptions="{state.sampleTableData.tableOptions}"
                    typeSort="{state.sampleTableData.typeSort}"
                    theme="{state.sampleTableData.theme}"
                    rebind="{setRebind}"
                    debugMode="{true}"
                    debug="{state.sampleTableData}"
                    ></widget-grid>
            </div>
            <hr class="my-4">
            <div class="card w-100">
                <div class="card-header">
                    External Input Controls {state.tray?' - Auto Generated':''}
                    <button 
                        type="button" 
                        class="btn btn-sm btn-secondary float-end"
                        onclick="{toggleInputMode}">
                        Input Mode: {state.tray?'Auto Generated':'Custom HTML'}
                    </button>
                </div>
                <div if="{state.tray}" class="card-body">
                    <widget-tray debugMode="{true}" {...state.sampleTableData.options}></widget-tray>
                </div>
                <div if="{!state.tray}" class="card-body">
                    <div class="alert alert-primary p-2">
                        <small>
                            Setup for binding inputs based on record selection defined within <strong>options.yourColumn.externalInput</strong>
                        </small>
                    </div>
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="state-input">State</label>
                                </div>
                                <select class="custom-select" id="state-input">
                                    <option disabled selected value> Select a State </option>
                                    <option value="NY">NY</option>
                                    <option value="NJ">NJ</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" for="city-input">City</span>
                                </div>
                                <input id="city-input" class="form-control" type="text" placeholder="e.g. Greenvale" />
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" for="address-input">Address</span>
                                </div>
                                <input id="address-input" class="form-control" type="text" placeholder="e.g. 100 Main St." />
                            </div>
                        </div>
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="sex-input">Sex</label>
                        </div>
                        <select class="custom-select" id="sex-input">
                            <option disabled selected value>--- select option ---</option>
                            <option value="M">Male</option>
                            <option value="F">Female</option>
                            <option value="O">Other</option>
                        </select>
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" for="start-date">Date Started</span>
                        </div>
                        <input id="start-date" class="form-control" type="datetime-local" placeholder="Employment Start Date" />
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="alert alert-primary p-2">
                                <small>
                                    Native form validation: <strong>required, minlength, maxlength, min, max, type, pattern</strong>
                                </small>
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" for="email-address">Email</span>
                                </div>
                                <input id="email-address" class="form-control" type="email" placeholder="Email@RestrictedEmail.com" pattern=".*[Rr]estricted[Ee]mail.com$"/>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="alert alert-primary p-2">
                                <small>
                                    Custom validations defined within <strong>options.yourColumn.customValidation</strong>
                                </small>
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" for="favorite-power-two">Favorite Power of Two</span>
                                </div>
                                <input id="favorite-power-two" class="form-control" type="number" placeholder="1,2,4,8,16" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-end">
                    <div class="alert alert-primary d-inline p-2"><small>Setup for external post defined within <strong>tableOptions.externalPost</strong></small></div>
                    <button id="demo-new" type="button" class="btn btn-primary ms-2">
                        New
                    </button>
                    <button id="demo-copy" type="button" class="btn btn-primary ms-2">
                        Copy
                    </button>
                </div>
            </div>
            <hr class="my-4">
        </div>
    </div>
    <div class="jumbotron jumbotron-fluid m-4">
        <div class="container">
            <h1 class="display-4 text-center text-muted">
                < widget-tree >
            </h1>
            <hr class="my-4">
            <div class="card w-100">
                <widget-tree debugMode="{true}"></widget-tree>
            </div>
            <hr class="my-4">
        </div>
    </div>
    <div class="jumbotron jumbotron-fluid m-4">
        <div class="container">
            <h1 class="display-4 text-center text-muted">
                < widget-card >
            </h1>
            <hr class="my-4">
            <div class="card w-100">
                <widget-card 
                    data="{state.sampleTableData.data}"
                    options="{state.sampleTableData.options}"
                    tableOptions="{state.sampleTableData.tableOptions}"
                    typeSort="{state.sampleTableData.typeSort}"
                    theme="{state.sampleTableData.theme}"
                    debugMode="{true}"
                    debug="{state.sampleTableData}"></widget-card>
            </div>
            <hr class="my-4">
        </div>
    </div>
    <div class="jumbotron jumbotron-fluid m-4">
        <div class="container">
            <h1 class="display-4 text-center text-muted">
                < widget-bracket >
            </h1>
            <hr class="my-4">
            <div class="card w-100">
                <div class="row m-2 mt-4">
                    <div class="col-sm-6">
                        <div class="form-floating">
                            <select id="Timezone-Viewer-Selection" 
                                class="form-select form-select-sm" 
                                aria-label="Select a display timezone" 
                                onchange="{(e)=>updateViewTimeZone(e)}">
                                <option value="local" selected="{state.view_timezone==='local'}">Use local timezone (default)</option>
                                <option each="{zone in Object.keys(state.timezones)}" selected="{state.view_timezone===zone}" value="{zone}">{zone}</option>
                            </select>
                            <label for="Timezone-Viewer-Selection">Select view timezone (i.e. Where viewers are)</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-floating">
                            <select id="Timezone-User-Selection" 
                                class="form-select form-select-sm" 
                                aria-label="Select a display timezone"
                                onchange="{(e)=>updateInputTimeZone(e)}">
                                <option value="local" selected="{state.input_timezone==='local'}">Use local timezone (default)</option>
                                <option each="{zone in Object.keys(state.timezones)}" selected="{state.input_timezone===zone}" value="{zone}">{zone}</option>
                            </select>
                            <label for="Timezone-User-Selection">Select input timezone (i.e. Where you are)</label>
                        </div>
                    </div>
                </div>
                <widget-bracket {...state.sampleBracketData}></widget-bracket>
            </div>
            <hr class="my-4">
        </div>
    </div>
    <style>
    input:invalid{
        border:1px solid salmon !important;
    }
    </style>
    <script>
        export default {
            state:{
                tray:false,
                sampleTableData:{
                    data:[
                        {
                            "Id":1,
                            "Name":"Ryan",
                            "Age":27,
                            "Email":"test@test.com",
                            "Is":false,
                            "StartDate":"2018-01-01T00:00:01",
                            "State":"NY",
                            "City":"Glen Cove",
                            "Address":"100 Test Street",
                            "Sex":"M",
                            "Email":"Ryan@RestrictedEmail.com",
                            "FavoritePowerTwo":64
                        },{
                            "Id":2,
                            "Name":"Kiichi",
                            "Age":null,
                            "Email":"anothertest@test.com",
                            "Is":true,
                            "StartDate":"2002-01-01T00:00:01",
                            "State":"NY",
                            "City":"Test City",
                            "Address":"200 Test Street",
                            "Sex":"M",
                            "Email":"Kiichi@RestrictedEmail.com",
                            "FavoritePowerTwo":128
                        },{
                            "Id":3,
                            "Name":"Justin",
                            "Age":null,
                            "Email":"testing123@test.com",
                            "Is":false,
                            "StartDate":"2018-01-01T00:00:01",
                            "State":"NY",
                            "City":"Another Test City",
                            "Address":"100 Test Street",
                            "Sex":"M",
                            "Email":"Justin@RestrictedEmail.com",
                            "FavoritePowerTwo":32
                        },{
                            "Id":4,
                            "Name":"Korey",
                            "Age":null,
                            "Email":"information@test.com",
                            "Is":false,
                            "StartDate":null,
                            "State":"NY",
                            "City":"Another Test City",
                            "Address":"150 Test Street",
                            "Sex":"M",
                            "Email":"Korey@RestrictedEmail.com",
                            "FavoritePowerTwo":16
                        },{
                            "Id":5,
                            "Name":"James",
                            "Age":null,
                            "Email":"testinformation@test.com",
                            "Is":false,
                            "StartDate":null,
                            "State":"NJ",
                            "City":"Cityopolis",
                            "Address":"100 Test Street",
                            "Sex":"M",
                            "Email":"James@RestrictedEmail.com",
                            "FavoritePowerTwo":256
                        }
                    ],
                    options:{
                        "Id":{
                            alias:"UserID",
                            pk:true,
                            put:false,
                            visible:false
                        },
                        "Name":{
                            alias:"Involved Person",
                            customValidation:{
                                message:"Number is not a power of two",
                                test:(value)=>{ return value.length>3; }
                            }
                        },
                        "Age":{
                            alias:"Incident Age",
                            type:Number,
                        },
                        "Is":{
                        
                        },
                        "StartDate":{
                            externalInput:"#start-date",
                            visible:false
                        },
                        "State":{
                            externalInput:"#state-input",
                            visible:false
                        },
                        "City":{
                            externalInput:"#city-input",
                            visible:false
                        },
                        "Address":{
                            externalInput:"#address-input",
                            visible:false
                        },
                        "Sex":{
                            externalInput:"#sex-input",
                            visible:false
                        },
                        "Email":{
                            externalInput:"#email-address",
                            visible:false
                        },
                        "FavoritePowerTwo":{
                            externalInput:"#favorite-power-two",
                            visible:false,
                            customValidation:{
                                message:"Number is not a power of two",
                                test:(value)=>{ return Number.isInteger(Math.log(parseFloat(value))/Math.log(2)); }
                            }
                            /*  Where .test must be the testable function, 
                                and   .message should be failure feedback,
                                and the rest of the data is re-packaged into
                                the validation callback
                            
                                Can be defined alternatively as:
                                customValidation:(value)=>{ return Number.isInteger(Math.log(2,value))}
                                where the canned invalid message is "Invalid field."
                                
                            */
                        }
                    },
                    tableOptions:{
                        put:true,
                        post:true,
                        delete:true,
                        externalPost:"#demo-create"
                    },
                    typeSort:{
                        "String":(a,b)=>{
                            return a.localeCompare(b);
                        },
                        "Number":(a,b)=>{
                            a=a==null?-Infinity:a;
                            b=b==null?-Infinity:b;
                            let result = parseFloat(a)-parseFloat(b);
                            if(isNaN(result)){
                                return 0;
                            }
                            else{
                                result=result==-Infinity?-1:result;
                                result=result==Infinity?1:result;
                                return result;
                            }
                        },
                        "Date":(a,b)=>{
                            return a-b;
                        },
                        "Boolean":(a,b)=>{
                            return a-b;
                        }
                    },
                    theme:{
                        bg:"white",
                        border:"light",
                        text:"dark"
                    },

                },
                sampleBracketData:{
                    data:new Array(16).fill(null).map((blank,index)=>{
                        let aPlayer = { name:`Player ${index}`, rating:Math.floor(((Math.random()*(2000 - 0)) - 0)) };
                        return aPlayer;
                    }),
                    options:{
                        name:{
                            content:true
                        },
                        rating:{
                            content:true,
                            statistic:true,
                            sort:true
                        }
                    },
                    bracket_settings:{
                        subdivision_size:2,
                        size:16,
                        title:"Testing",
                        show:{
                            title:false,
                            statistics:false
                        }
                    },
                    callbacks:{
                        post:null,
                        put:null,
                        time_output:null,
                        time_input_input:null,
                        time_input_output:null
                    }
                },
                timezones:timezones,
                view_timezone:"UTC",
                input_timezone:"local",
                rebind:null
            },
            onBeforeMount(){
                let thisRef = this;
                this.state.sampleBracketData.callbacks.time_output=((time_iso)=>{
                    return this.state.view_timezone === "local" ? 
                        luxon.DateTime.fromISO(time_iso).toLocaleString(luxon.DateTime.DATETIME_FULL) :
                        luxon.DateTime.fromISO(time_iso,{zone:this.state.view_timezone}).toLocaleString(luxon.DateTime.DATETIME_FULL);
                }).bind(thisRef);
                this.state.sampleBracketData.callbacks.time_input_input=((time_iso)=>{
                    return this.state.input_timezone === "local" ?
                        luxon.DateTime.fromISO(time_iso).toISO().toString().slice(0,23) :
                        luxon.DateTime.fromISO(time_iso).toISO({zone:this.state.input_timezone}).toString().slice(0,23);
                        }).bind(thisRef);
                this.state.sampleBracketData.callbacks.time_input_output=((time_iso)=>{
                    return this.state.input_timezone === "local" ? 
                        luxon.DateTime.fromISO(time_iso).toUTC().toString() :
                        luxon.DateTime.fromISO(time_iso,{zone:this.state.input_timezone}).toUTC().toString();
                        }).bind(thisRef);
            },
            updateViewTimeZone(e){
                this.state.view_timezone = e.target.value;
                this.update();
            },
            updateInputTimeZone(e){
                this.state.input_timezone = e.target.value;
                this.update();
            },
            getData(){
                //send request to get data
            },
            putData(input){
                //send data to server to mutate record
            },
            postData(){
                //send data to server to create record
            },
            toggleInputMode(){
                this.state.rebind();
                this.state.tray=!this.state.tray;
                this.update();
            },
            setRebind(rebindFunc){
                this.state.rebind=rebindFunc;
            },
        }
    </script>
</demo>